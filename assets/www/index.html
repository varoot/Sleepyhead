<!doctype html>
<html>
<head>
	<title>Sleepyhead - Input</title>
	<link rel="stylesheet" href="jquery.mobile-1.0.1.min.css">
	<link rel="stylesheet" href="mobiscroll-1.5.3.min.css">
	<link rel="stylesheet" href="style.css">
	<script type="text/javascript" charset="utf-8" src="js/cordova-1.5.0.js"></script>
	<script type="text/javascript" src="js/jquery-1.7.1.min.js"></script>
    <script type="text/javascript" src="js/jquery.mobile-1.0.1.min.js"></script>
    <script type="text/javascript" src="js/mobiscroll-1.5.3.min.js"></script>
    <script type="text/javascript" src="js/processing-1.3.6.min.js"></script>
	<script type="text/javascript" charset="utf-8">
		var expData = 'Energy,3/28/2012 07:00:21,3,\n\
			Energy,3/28/2012 08:10:26,5,Note\n\
			Energy,3/28/2012 11:40:26,4,Note\n\
			Energy,3/28/2012 15:10:28,7,Note\n\
			Energy,3/28/2012 15:30:28,6,Note';	
	
		document.addEventListener("deviceready", onDeviceReady, false);
		var db;
		//this is test comment
		function createDB(tx) {
			tx.executeSql('CREATE TABLE IF NOT EXISTS data (id unique, name)');
		}
		
		function errorCB(err) {
			alert('Error: '+err);
		}

		function successCB() {
			//alert('Success');
		}

		// PhoneGap is ready
		function onDeviceReady() {
			db = window.openDatabase("sleepyhead", "1.0", "Sleepyhead DB", 1000000);
			db.transaction(createDB, errorCB, successCB);
		}
		
		$(function() {
			$("input[id|=date]").scroller({ preset: 'datetime', theme: 'ios' });
			$("#activity").change(function() {
				if ($(this).children('option[selected]').eq(0).hasClass('duration')) {
					$("#input-date-end").show();
				} else {
					$("#input-date-end").hide();
				}
			});
		});
		
		// write the input to file
		function doSubmit(){
			
			
			var activityList = document.all("activity");
			var activityText = activityList.options[activityList.selectedIndex].text;
			
			//alert(activityText);
			
			var startDateText = document.getElementById('date-start').value;
			
			//alert(startDateText);
			
			var endDateText = document.getElementById('date-end').value;
			
			//alert(endDateText);
			
			var noteText = document.getElementById('note').value;
			
			//alert(noteText);
			
			//alert(activityText + "\n" + startDateText + "\n" + endDateText + "\n" + noteText);
			
			
			MyWriteToFile(activityText + "," + startDateText + "," + endDateText + "," + noteText + "\n");
		}
		
		
		// file writing
		
		var contentToWrite = "";
		
		function MyWriteToFile( myString ){
			contentToWrite = myString;
			
			// the folder
			//window.requestFileSystem(LocalFileSystem.PERSISTENT, 0, gotFolder, fail);
			
			// the file
			window.requestFileSystem(LocalFileSystem.PERSISTENT, 0, gotFS, fail);
		}
		
		// for folder
		function successDirectory(parent) {
		    console.log("Parent Name: " + parent.name);
		}

		function failDirectory(error) {
		    alert("Unable to create new directory: " + error.code);
		}

		// Retrieve an existing directory, or create it if it does not already exist

		function gotFS(fileSystem) {
			
			fileSystem.root.getDirectory("SleepyHead", {create: true, exclusive: false}, successDirectory, failDirectory);
			
		    fileSystem.root.getFile("SleepyHead/sleepyhead_record.csv", {create: true, exclusive: false}, gotFileEntry, fail);
		}
		
		function gotFileEntry(fileEntry) {
		    fileEntry.createWriter(gotFileWriter, fail);
		}
		
		function gotFileWriter(writer) {
		    writer.onwrite = function(evt) {
		        console.log("write success");
		    };
		    writer.seek(writer.length);
		    writer.write(contentToWrite);
		}
		
		function fail(error) {
			alert("getFileFail:" + error);
		    console.log(error.code);
		}
	</script>
</head>
<body>
	<div data-role="page" id="home">
		<div data-theme="a" data-role="header" data-position="fixed">
			<h1>Sleepyhead App</h1>
		</div>
		<div data-role="content">
			<div>
				<a href="exp.html">Experience Sampling</a>
			</div>
			<div>
				<a href="self_report.html">Self Report</a>
			</div>
			<div>
				<a href="#visualization">Visualization</a>
			</div>
		</div>
	</div>
	<div data-role="page" id="visualization" data-add-back-btn="true">
		<div data-role="header" data-position="fixed">
			<h1>Visualization</h1>
		</div>
		<div data-role="content">
			<canvas data-processing-sources="chart.pde"></canvas>
		</div>
	</div>
</body>
</html>